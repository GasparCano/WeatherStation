<!DOCTYPE html>

<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Holmön väderstation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
	<script src="js/jquery-2.0.3.min.js"></script>
	<script src="js/globalize.min.js"></script>
	<script src="js/dx.chartjs.js"></script>   
	<script src="js/underscore.js"></script>   
	<script src="js/weatherstation.js"></script>   
	
	<link rel="icon" type="image/x-icon" href="favicon.ico">
	
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">
  	<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
  	<!--  <link rel="stylesheet" href="css/weatherstation.css">  -->
  	<link href="css/bootstrap.min.css" rel="stylesheet">
  	
  	  <script>
  	  /* Google analytics junk */
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	
	  ga('create', 'UA-46361998-1', '213-21-80-50.customer.t3.se');
	  ga('send', 'pageview');


  	  
  	  

	  </script>
  </head>

	<body>
  		<div class="container">
  			<div class="page-header">
  				<h1>Fjärrsensor <small>Temperaturmätning Holmön</small></h1>
			</div>
			<div id="dataNotLoadedArea">
				<img src="images/loading.gif" alt="Loading data..." />
			</div>
			<div id="dataNotAvailableArea" style="display:none">
				<div class="alert alert-danger">Det finns inga registrerade temperaturmätningar för denna sensor. Kontrollera att temperatursensorn är inkopplad, har nätverksanslutning och skickar data till mätservern.</div>						
			</div>
			
			<div id="dataLoadedArea" style="display:none">
				<div class="alert alert-success" id="alertBoxOnline">Fjärrsensorn har varit <b>online</b> <span id="upTime"></span>.</div>
				<div class="alert alert-danger" id="alertBoxOffline">Fjärrsensorn har varit <b>offline</b> <span id="downTime"></span></div>						

				<div class="row">
					<div class="col-xs-6 col-md-4">Senaste mätning inomhus:</div>
					<div class="col-xs-6 col-md-8"><b><span id="latestDayReadingCurrentTemp1"></span> &deg;C kl <span id="latestDayReadingCurrentTime1"></span></b></div>
				</div>  	
				<div class="row">
					<div class="col-xs-6 col-md-4">Senaste mätning utomhus:</div>
					<div class="col-xs-6 col-md-8"><b><span id="latestDayReadingCurrentTemp2">### Not connected ###</span> &deg;C kl <span id="latestDayReadingCurrentTime2"></span></b></div>
				</div>  	
	
				<h2><span id="detailedDayCaption"></span></h2>
				<div class="row">
					<div class="col-xs-6 col-md-4">Högsta temperatur inne:</div>
					<div class="col-xs-6 col-md-8"><b><span id="latestDayReadingHighestTemp1"></span> &deg;C kl <span id="latestDayReadingHighestTime1"></span></b></div>
				</div>  	
				<div class="row">
					<div class="col-xs-6 col-md-4">Lägsta temperatur inne:</div>
					<div class="col-xs-6 col-md-8"><b><span id="latestDayReadingLowestTemp1"></span> &deg;C kl <span id="latestDayReadingLowestTime1"></span></b></div>
				</div>  	
				<div class="row">
					<div class="col-xs-6 col-md-4">Medeltemperatur inne:</div>
					<div class="col-xs-6 col-md-8"><b><span id="latestDayReadingAverageTemp1"></span> &deg;C</b></div>
				</div>  	
				<br/>
				<div class="row">
					<div class="col-xs-12 col-md-12">
						<div id="chartContainerToday1" class="containers" style="height: 300px; width: 100%;"></div>
					</div>
				</div>
				
				<div class="row">
					<div class="col-xs-6 col-md-4">Högsta temperatur ute:</div>
					<div class="col-xs-6 col-md-8"><b><span id="latestDayReadingHighestTemp2">### Not connected ###</span> &deg;C kl <span id="latestDayReadingHighestTime2"></span></b></div>
				</div>  	
				<div class="row">
					<div class="col-xs-6 col-md-4">Lägsta temperatur ute:</div>
					<div class="col-xs-6 col-md-8"><b><span id="latestDayReadingLowestTemp2">### Not connected ###</span> &deg;C kl <span id="latestDayReadingLowestTime2"></span></b></div>
				</div>  	
				<div class="row">
					<div class="col-xs-6 col-md-4">Medeltemperatur ute:</div>
					<div class="col-xs-6 col-md-8"><b><span id="latestDayReadingAverageTemp2">### Not connected ###</span> &deg;C</b></div>
				</div>  	
				<br/>
				<div class="row">
					<div class="col-xs-12 col-md-12">
						<div id="chartContainerToday2" class="containers" style="height: 300px; width: 100%;"></div>
					</div>
				</div>  	

				  	
				<div class="row">
					<div class="col-xs-12 col-md-12">
						<button type="button" class="btn btn-default" id="goBackBtn">
						  <span class="glyphicon glyphicon-arrow-left"></span> En dag bakåt
						</button>					
						<input type="text" id="datepicker">
						<button type="button" class="btn btn-default" id="goForwardBtn">
						  <span class="glyphicon glyphicon-arrow-right"></span> En dag framåt
						</button>					
					</div>
				</div>  	
		
	
				<h2>Senaste veckan</h2>
				<div class="row">
					<div class="col-xs-6 col-md-4">Högsta temperatur inne:</div>
					<div class="col-xs-6 col-md-8"><b><span id="latestWeekReadingHighestTemp1"></span> &deg;C kl <span id="latestWeekReadingHighestTime1"></span></b></div>
				</div>  	
				<div class="row">
					<div class="col-xs-6 col-md-4">Lägsta temperatur inne:</div>
					<div class="col-xs-6 col-md-8"><b><span id="latestWeekReadingLowestTemp1"></span> &deg;C kl <span id="latestWeekReadingLowestTime1"></span></b></div>
				</div>  	
				<div class="row">
					<div class="col-xs-6 col-md-4">Medeltemperatur inne:</div>
					<div class="col-xs-6 col-md-8"><b><span id="latestWeekReadingAverageTemp1"></span> &deg;C</b></div>
				</div>  	
	
				<br/>
		
				<div class="row">
					<div class="col-xs-12 col-md-12">
						<div id="chartContainerWeek1" class="containers" style="height: 300px; width: 100%;"></div>
					</div>
				</div>  	

				<div class="row">
					<div class="col-xs-6 col-md-4">Högsta temperatur ute:</div>
					<div class="col-xs-6 col-md-8"><b><span id="latestWeekReadingHighestTemp2">### Not connected ###</span> &deg;C kl <span id="latestWeekReadingHighestTime2"></span></b></div>
				</div>  	
				<div class="row">
					<div class="col-xs-6 col-md-4">Lägsta temperatur ute:</div>
					<div class="col-xs-6 col-md-8"><b><span id="latestWeekReadingLowestTemp2">### Not connected ###</span> &deg;C kl <span id="latestWeekReadingLowestTime2"></span></b></div>
				</div>  	
				<div class="row">
					<div class="col-xs-6 col-md-4">Medeltemperatur ute:</div>
					<div class="col-xs-6 col-md-8"><b><span id="latestWeekReadingAverageTemp2">### Not connected ###</span> &deg;C</b></div>
				</div>  	
	
				<br/>
		
				<div class="row">
					<div class="col-xs-12 col-md-12">
						<div id="chartContainerWeek2" class="containers" style="height: 300px; width: 100%;"></div>
					</div>
				</div>  	


			
				<h2>Senaste m&aring;naden</h2>
				<div class="row">
					<div class="col-xs-6 col-md-4">Högsta temperatur inne:</div>
					<div class="col-xs-6 col-md-8"><b><span id="latestMonthReadingHighestTemp1"></span> &deg;C kl <span id="latestMonthReadingHighestTime1"></span></b></div>
				</div>  	
				<div class="row">
					<div class="col-xs-6 col-md-4">Lägsta temperatur inne:</div>
					<div class="col-xs-6 col-md-8"><b><span id="latestMonthReadingLowestTemp1"></span> &deg;C kl <span id="latestMonthReadingLowestTime1"></span></b></div>
				</div>  	
				<div class="row">
					<div class="col-xs-6 col-md-4">Medeltemperatur inne:</div>
					<div class="col-xs-6 col-md-8"><b><span id="latestMonthReadingAverageTemp1"></span> &deg;C</b></div>
				</div>  	
	
				<br/>
		
				<div class="row">
					<div class="col-xs-12 col-md-12">
						<div id="chartContainerMonth1" class="containers" style="height: 300px; width: 100%;"></div>
					</div>
				</div>
				

				<div class="row">
					<div class="col-xs-6 col-md-4">Högsta temperatur ute:</div>
					<div class="col-xs-6 col-md-8"><b><span id="latestMonthReadingHighestTemp2">### Not connected ###</span> &deg;C kl <span id="latestMonthReadingHighestTime2"></span></b></div>
				</div>  	
				<div class="row">
					<div class="col-xs-6 col-md-4">Lägsta temperatur ute:</div>
					<div class="col-xs-6 col-md-8"><b><span id="latestMonthReadingLowestTemp2">### Not connected ###</span> &deg;C kl <span id="latestMonthReadingLowestTime2"></span></b></div>
				</div>  	
				<div class="row">
					<div class="col-xs-6 col-md-4">Medeltemperatur ute:</div>
					<div class="col-xs-6 col-md-8"><b><span id="latestMonthReadingAverageTemp2">### Not connected ###</span> &deg;C</b></div>
				</div>  	
	
				<br/>
		
				<div class="row">
					<div class="col-xs-12 col-md-12">
						<div id="chartContainerMonth2" class="containers" style="height: 300px; width: 100%;"></div>
					</div>
				</div>  	
				
				  	
			</div>
		
			<script>
	
	
	
	
	function chartTemperature(settings) {
					
		$(settings.chartContainer).dxChart({
		    dataSource: settings.dataSource,
		    commonSeriesSettings: {
		        type: "spline",
		        argumentField: "time"
		    },
		    commonAxisSettings: {
		        grid: {
		            visible: true
		        }
		    },
		    series: [
		        { valueField: "temp", name: settings.curveExplanation }
		    ],
		    tooltip:{
		        enabled: true
		    },
		    legend: {
		        verticalAlignment: "bottom",
		        horizontalAlignment: "center"
		    },
		    title: settings.title,
		    commonPaneSettings: {
		        border:{
		            visible: true,
		            bottom: false
		        }
		    }
		});
	}
	

	function guid() {
		function s4() {
			return Math.floor((1 + Math.random()) * 0x10000)
	             .toString(16)
	             .substring(1);
		}

		return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
	         s4() + '-' + s4() + s4() + s4();
	}
	
	function reloadWithDifferentDate(yyyymmdd, key) {
		window.location.search = "key=" + key + "&date=" + yyyymmdd; 
	}
	

	
	
	/* Which application key are we using? */
    var key1 = queryString.key;
	if (key1 === undefined) {
		key1 = "holmon";
	}
	var key2 = "holmon2";
	var detailedDate = queryString.date;
	if (detailedDate === undefined) {
		detailedDate = toYYYYMMDD(new Date());
	}
	
	/* Setup init state before AJAX */ 
	$("#alertBoxOnline").hide();
	$("#alertBoxOffline").hide();
	
	var holmon2Data = null;
	
	$.get("/WeatherStationServer/api/temperature/" + key2 + "?date=" + detailedDate, function(data2, status2) {
		holmon2Data = data2;
		
		$.get("/WeatherStationServer/api/temperature/" + key1 + "?date=" + detailedDate, function(data, status) {
			
			function tempInfoConverterHHMM(info) { 
				return { 
					temp: info.temp, 
					time: toHHMM(info.time)
				}; 
			}
			
			function tempInfoConverterYYMMDDHHMM(info) { 
				return { 
					temp: info.temp, 
					time: toYYMMDDHHMM(info.time)
				}; 
			}
			
			function updateGUIWhenDataIsAvailable(temperatureInfo, temperatureInfo2, key) {
				var sensorActive = temperatureInfo.remoteSensorActive;
				var currentTemp = temperatureInfo.currentTemp;
				
				var hasRegisteredOutsideTemp = temperatureInfo2.hasRegisteredData;
				
				var todaysTemperatureInfo = _.map(temperatureInfo.todaysTemperature.temperatureInfo, tempInfoConverterHHMM);
				var weeksTemperatureInfo = _.map(temperatureInfo.weeksTemperature.temperatureInfo, tempInfoConverterYYMMDDHHMM);
				var monthsTemperatureInfo = _.map(temperatureInfo.monthsTemperature.temperatureInfo, tempInfoConverterYYMMDDHHMM);

				var todaysTemperatureInfo2 = _.map(temperatureInfo2.todaysTemperature.temperatureInfo, tempInfoConverterHHMM);
				var weeksTemperatureInfo2 = _.map(temperatureInfo2.weeksTemperature.temperatureInfo, tempInfoConverterYYMMDDHHMM);
				var monthsTemperatureInfo2 = _.map(temperatureInfo2.monthsTemperature.temperatureInfo, tempInfoConverterYYMMDDHHMM);

				
				
				/* Switch from loading mode to display mode */
				$("#dataNotLoadedArea").hide();
				$("#dataLoadedArea").show();
				
				
				
				/* Update the alert boxes */
				if (sensorActive) {
					$("#alertBoxOnline").show("slow", function() {});
					$("#upTime").html(millisToHumanTime(temperatureInfo.upOrDownTime));
				} else {
					$("#alertBoxOffline").show("slow", function() {});
					$("#downTime").html(millisToHumanTime(temperatureInfo.upOrDownTime));
				}
				
				/* Latest day updates */
				$("#latestDayReadingCurrentTemp1").html(temperatureInfo.currentTemp.temp);
				$("#latestDayReadingCurrentTime1").html(toYYMMDDHHMM(temperatureInfo.currentTemp.time));
				$("#latestDayReadingHighestTemp1").html(temperatureInfo.todaysTemperature.highestTemperature.temp);
				$("#latestDayReadingHighestTime1").html(toHHMM(temperatureInfo.todaysTemperature.highestTemperature.time));
				$("#latestDayReadingLowestTemp1").html(temperatureInfo.todaysTemperature.lowestTemperature.temp);
				$("#latestDayReadingLowestTime1").html(toHHMM(temperatureInfo.todaysTemperature.lowestTemperature.time));
				$("#latestDayReadingAverageTemp1").html(temperatureInfo.todaysTemperature.averageTemperature);

				if (hasRegisteredOutsideTemp) {
					$("#latestDayReadingCurrentTemp2").html(temperatureInfo2.currentTemp.temp);
					$("#latestDayReadingCurrentTime2").html(toYYMMDDHHMM(temperatureInfo2.currentTemp.time));
					$("#latestDayReadingHighestTemp2").html(temperatureInfo2.todaysTemperature.highestTemperature.temp);
					$("#latestDayReadingHighestTime2").html(toHHMM(temperatureInfo2.todaysTemperature.highestTemperature.time));
					$("#latestDayReadingLowestTemp2").html(temperatureInfo2.todaysTemperature.lowestTemperature.temp);
					$("#latestDayReadingLowestTime2").html(toHHMM(temperatureInfo2.todaysTemperature.lowestTemperature.time));
					$("#latestDayReadingAverageTemp2").html(temperatureInfo2.todaysTemperature.averageTemperature);
				}
				
				var detailedDay = toYYYYMMDD(temperatureInfo.todaysTemperature.periodToDate);
				if (detailedDay === toYYYYMMDD(new Date())) {
					$("#detailedDayCaption").html("Senaste dygnet");
				} else {
					$("#detailedDayCaption").html(getSwedishWeekdayName(temperatureInfo.todaysTemperature.periodToDate) + " " + toYYYYMMDDDashed(temperatureInfo.todaysTemperature.periodToDate));
				}
	
				$('#datepicker').datepicker({ 
					dateFormat: "yymmdd",
					onSelect: function(dateText) {
						var selected = $("#datepicker").datepicker("getDate");
						var formatted = toYYYYMMDD(selected.getTime());
						reloadWithDifferentDate(formatted, key);
					}
				});
				
				$('#datepicker').datepicker("setDate", new Date(temperatureInfo.todaysTemperature.periodToDate));
				
				$('#goBackBtn').on('click', function (e) {
					var newDate = toYYYYMMDD(addDays(new Date(temperatureInfo.todaysTemperature.periodToDate), -1));
					reloadWithDifferentDate(newDate, key);
				})
				$('#goForwardBtn').on('click', function (e) {
					var newDate = toYYYYMMDD(addDays(new Date(temperatureInfo.todaysTemperature.periodToDate), 1));
					reloadWithDifferentDate(newDate, key);
				})
				
				/* Latest week*/
				$("#latestWeekReadingHighestTemp1").html(temperatureInfo.weeksTemperature.highestTemperature.temp);
				$("#latestWeekReadingHighestTime1").html(toYYMMDDHHMM(temperatureInfo.weeksTemperature.highestTemperature.time));
				$("#latestWeekReadingLowestTemp1").html(temperatureInfo.weeksTemperature.lowestTemperature.temp);
				$("#latestWeekReadingLowestTime1").html(toYYMMDDHHMM(temperatureInfo.weeksTemperature.lowestTemperature.time));
				$("#latestWeekReadingAverageTemp1").html(temperatureInfo.weeksTemperature.averageTemperature);

				if (hasRegisteredOutsideTemp) {
					$("#latestWeekReadingHighestTemp2").html(temperatureInfo2.weeksTemperature.highestTemperature.temp);
					$("#latestWeekReadingHighestTime2").html(toYYMMDDHHMM(temperatureInfo2.weeksTemperature.highestTemperature.time));
					$("#latestWeekReadingLowestTemp2").html(temperatureInfo2.weeksTemperature.lowestTemperature.temp);
					$("#latestWeekReadingLowestTime2").html(toYYMMDDHHMM(temperatureInfo2.weeksTemperature.lowestTemperature.time));
					$("#latestWeekReadingAverageTemp2").html(temperatureInfo2.weeksTemperature.averageTemperature);
				}
				
				/* Latest month*/
				$("#latestMonthReadingHighestTemp1").html(temperatureInfo.monthsTemperature.highestTemperature.temp);
				$("#latestMonthReadingHighestTime1").html(toYYMMDDHHMM(temperatureInfo.monthsTemperature.highestTemperature.time));
				$("#latestMonthReadingLowestTemp1").html(temperatureInfo.monthsTemperature.lowestTemperature.temp);
				$("#latestMonthReadingLowestTime1").html(toYYMMDDHHMM(temperatureInfo.monthsTemperature.lowestTemperature.time));
				$("#latestMonthReadingAverageTemp1").html(temperatureInfo.monthsTemperature.averageTemperature);

				if (hasRegisteredOutsideTemp) {
					$("#latestMonthReadingHighestTemp2").html(temperatureInfo2.monthsTemperature.highestTemperature.temp);
					$("#latestMonthReadingHighestTime2").html(toYYMMDDHHMM(temperatureInfo2.monthsTemperature.highestTemperature.time));
					$("#latestMonthReadingLowestTemp2").html(temperatureInfo2.monthsTemperature.lowestTemperature.temp);
					$("#latestMonthReadingLowestTime2").html(toYYMMDDHHMM(temperatureInfo2.monthsTemperature.lowestTemperature.time));
					$("#latestMonthReadingAverageTemp2").html(temperatureInfo2.monthsTemperature.averageTemperature);
				}
				
				
				chartTemperature({
									chartContainer: "#chartContainerToday1", 
									dataSource: todaysTemperatureInfo,
									curveExplanation: "Temp senaste dygnet inomhus (C)",
									title: ""
								});
			
				chartTemperature({
									chartContainer: "#chartContainerWeek1", 
									dataSource: weeksTemperatureInfo,
									curveExplanation: "Temp senaste veckan inomhus (C)",
									title: ""
								});
			
				chartTemperature({
									chartContainer: "#chartContainerMonth1", 
									dataSource: monthsTemperatureInfo,
									curveExplanation: "Temp senaste månaden inomhus (C)",
									title: ""
								});
				
				chartTemperature({
					chartContainer: "#chartContainerToday2", 
					dataSource: todaysTemperatureInfo2,
					curveExplanation: "Temp senaste dygnet utomhus (C)",
					title: ""
				});

				chartTemperature({
					chartContainer: "#chartContainerWeek2", 
					dataSource: weeksTemperatureInfo2,
					curveExplanation: "Temp senaste veckan utomhus (C)",
					title: ""
				});

				chartTemperature({
					chartContainer: "#chartContainerMonth2", 
					dataSource: monthsTemperatureInfo2,
					curveExplanation: "Temp senaste månaden utomhus (C)",
					title: ""
				});
				
			}
			
			var hasRegisteredData = data.temperatureInfo.hasRegisteredData;
	
			/* Do we have any temperature readings available on the server? */
			
			if (hasRegisteredData) {
				updateGUIWhenDataIsAvailable(data.temperatureInfo, holmon2Data.temperatureInfo, key1);
			} else {
				/* Show the error message for sensor failures */
				$("#dataNotLoadedArea").hide();
				$("#dataLoadedArea").hide();
				$("#dataNotAvailableArea").show();
			}
	
		
		});
	});
	
	
		
		</script>
	    <script src="js/bootstrap.min.js"></script>
	    
	   </div>	
  </body>
</html>
