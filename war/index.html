<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- The HTML 4.01 Transitional DOCTYPE declaration-->
<!-- above set at the top of the file will set     -->
<!-- the browser's rendering engine into           -->
<!-- "Quirks Mode". Replacing this declaration     -->
<!-- with a "Standards Mode" doctype is supported, -->
<!-- but may lead to some differences in layout.   -->

<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Holmön väderstation</title>
    
	<script src="js/jquery-2.0.3.min.js"></script>
	<!--script src="js/knockout-3.0.0.js"></script-->
	<!--script src="js/angular.min.js"></script-->
	<script src="js/globalize.min.js"></script>
	<script src="js/dx.chartjs.js"></script>   
	<script src="js/underscore.js"></script>   
	
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">
  	<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
  	<link rel="stylesheet" href="css/weatherstation.css">
  	
  	  <script>
	  $(function() {
	    $( "#datepicker" ).datepicker({ dateFormat: "yymmdd" });
	  });
	  </script>
  </head>

  <body>
	
	<div>
		<span class="shoutout" id="currentTimeSpan">Laddar temperaturdata från server...</span> 
	</div>
	<div>
		<span class="shoutout" id="coldestTemp"></span> 
	</div>
	
	<div id="chartContainerToday" class="containers" style="height: 440px; width: 95%;"></div>
	<div id="chartContainerWeek" class="containers" style="height: 440px; width: 95%;"></div>
	<div id="chartContainerMonth" class="containers" style="height: 440px; width: 95%;"></div>

	
	<script>

function toHHMM(rawTime) {
	var d = new Date(rawTime);
	var m = d.getMinutes();
	if (m < 10) {
		m = "0" + "" + m;
	}
	return d.getHours() + ":" + m;
}

function chartTemperature(settings) {
				
	$(settings.chartContainer).dxChart({
	    dataSource: settings.dataSource,
	    commonSeriesSettings: {
	        type: "spline",
	        argumentField: "time"
	    },
	    commonAxisSettings: {
	        grid: {
	            visible: true
	        }
	    },
	    series: [
	        { valueField: "temp", name: settings.curveExplanation }
	    ],
	    tooltip:{
	        enabled: true
	    },
	    legend: {
	        verticalAlignment: "bottom",
	        horizontalAlignment: "center"
	    },
	    title: settings.title,
	    commonPaneSettings: {
	        border:{
	            visible: true,
	            bottom: false
	        }
	    }
	});
}

$.get("/api/temperature/stugan", function(data,status) {
	
	function tempInfoConverter(info) { 
		return { 
			temp: info.temp, 
			time: toHHMM(info.time)
		}; 
	}
	
	var currentTemp = data.temperatureInfo.currentTemp;
	var currentTime = data.temperatureInfo.currentTime;
	var todaysLowestTemperature = data.temperatureInfo.todaysTemperature.lowestTemperature;
	var todaysHighestTemperature = data.temperatureInfo.todaysTemperature.highestTemperature;
	var todaysTemperatureInfo = _.map(data.temperatureInfo.todaysTemperature.temperatureInfo, tempInfoConverter);
	var weeksTemperatureInfo = _.map(data.temperatureInfo.weeksTemperature.temperatureInfo, tempInfoConverter);
	var monthsTemperatureInfo = _.map(data.temperatureInfo.monthsTemperature.temperatureInfo, tempInfoConverter);
	
	$("#currentTimeSpan").html("Klockan <b>" + toHHMM(currentTime) + "</b> var temperaturen <b>" + currentTemp + " &deg;C</b>.");
	$("#coldestTemp").html("Lägsta uppmätta temperatur senaste dygnet är <b>" + todaysLowestTemperature + " &deg;C</b>. Högsta temperatur är <b>" + todaysHighestTemperature + " &deg;C</b>.");
	
	chartTemperature({
						chartContainer: "#chartContainerToday", 
						dataSource: todaysTemperatureInfo,
						curveExplanation: "Temp senaste dygnet (C)",
						title: "Temperatur i stugan 2013-12-09"
					});

	chartTemperature({
						chartContainer: "#chartContainerWeek", 
						dataSource: weeksTemperatureInfo,
						curveExplanation: "Temp senaste veckan (C)",
						title: "Temperatur i stugan 2013-12-09"
					});

	chartTemperature({
						chartContainer: "#chartContainerMonth", 
						dataSource: monthsTemperatureInfo,
						curveExplanation: "Temp senaste månaden (C)",
						title: "Temperatur i stugan 2013-12-09"
					});

});


			
	
	
	</script>
  </body>
</html>
